<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="Infinite Tower - Roguelike Auto-Battler">
    
    <title>Infinite Tower</title>
    
    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Game Container -->
    <div id="game-container">
        
        <!-- Main Menu Screen -->
        <div id="screen-menu" class="screen active">
            <div class="title-container">
                <h1 class="game-title">INFINITE TOWER</h1>
                <div class="subtitle">Roguelike Auto-Battler</div>
                <div class="version">v2.10.1</div>
            </div>
            
            <div class="menu-content">
                <button id="btn-play" class="btn btn-primary btn-large">
                    âš”ï¸ PLAY
                </button>
                
                <div class="difficulty-section">
                    <h3>Difficulty</h3>
                    <div class="difficulty-buttons">
                        <button class="btn btn-difficulty" data-difficulty="easy">
                            Easy
                        </button>
                        <button class="btn btn-difficulty active" data-difficulty="normal">
                            Normal
                        </button>
                        <button class="btn btn-difficulty" data-difficulty="hard">
                            Hard
                        </button>
                    </div>
                </div>
                
                <button id="btn-how-to-play" class="btn btn-secondary">
                    ğŸ“– How to Play
                </button>
                
                <button id="btn-top-runs" class="btn btn-secondary">
                    ğŸ† Top 3 Runs
                </button>
                
                <!-- Top Runs Panel -->
                <div id="top-runs-panel" class="panel hidden">
                    <h3>Best 3 Runs</h3>
                    <div id="top-runs-list"></div>
                </div>
            </div>
        </div>
        
        <!-- Stat Allocation Screen -->
        <div id="screen-stats" class="screen">
            <div class="screen-header">
                <h2 id="stats-title">Initial Build</h2>
            </div>
            
            <!-- Active Relics Display -->
            <div id="stats-relics" class="stats-relics">
                <!-- Relic slots will be populated here -->
            </div>
            
            <div class="stats-content">
                <div class="stat-row" data-stat="attackSpeed">
                    <div class="stat-info">
                        <div class="stat-name">âš¡ Attack Speed</div>
                        <div class="stat-value">
                            Base: <span id="stat-attackSpeed-base">1.0</span>
                            <span class="stat-separator">â†’</span>
                            <span id="stat-attackSpeed-total">1.0</span>/s
                            <span class="stat-max"></span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="attackSpeed">âˆ’</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="attackSpeed">+</button>
                    </div>
                </div>
                
                <div class="stat-row" data-stat="attack">
                    <div class="stat-info">
                        <div class="stat-name">âš”ï¸ Attack</div>
                        <div class="stat-value">
                            Base: <span id="stat-attack-base">10</span>
                            <span class="stat-separator">â†’</span>
                            <span id="stat-attack-total">10</span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="attack">âˆ’</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="attack">+</button>
                    </div>
                </div>
                
                <div class="stat-row" data-stat="crit">
                    <div class="stat-info">
                        <div class="stat-name">ğŸ’¥ Critical</div>
                        <div class="stat-value">
                            Base: <span id="stat-crit-base">5</span>%
                            <span class="stat-separator">â†’</span>
                            <span id="stat-crit-total">5</span>%
                            <span class="stat-max"></span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="crit">âˆ’</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="crit">+</button>
                    </div>
                </div>
                
                <div class="stat-row" data-stat="lifesteal">
                    <div class="stat-info">
                        <div class="stat-name">ğŸ©¸ Lifesteal</div>
                        <div class="stat-value">
                            Base: <span id="stat-lifesteal-base">0</span>%
                            <span class="stat-separator">â†’</span>
                            <span id="stat-lifesteal-total">0</span>%
                            <span class="stat-max"></span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="lifesteal">âˆ’</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="lifesteal">+</button>
                    </div>
                </div>
                
                <div class="stat-row" data-stat="defense">
                    <div class="stat-info">
                        <div class="stat-name">ğŸ›¡ï¸ Defense</div>
                        <div class="stat-value">
                            Base: <span id="stat-defense-base">5</span>
                            <span class="stat-separator">â†’</span>
                            <span id="stat-defense-total">5</span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="defense">âˆ’</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="defense">+</button>
                    </div>
                </div>
                
                <div class="stat-row" data-stat="hp">
                    <div class="stat-info">
                        <div class="stat-name">â¤ï¸ Max HP</div>
                        <div class="stat-value">
                            Base: <span id="stat-hp-base">100</span>
                            <span class="stat-separator">â†’</span>
                            <span id="stat-hp-total">100</span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="hp">âˆ’</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="hp">+</button>
                    </div>
                </div>
            </div>
            
            <div class="stats-actions">
                <button id="btn-start-battle" class="btn btn-primary btn-large" disabled>
                    Allocate all points first
                </button>
                
                <button id="btn-stats-home" class="btn btn-abandon">
                    ğŸ  Home
                </button>
            </div>
        </div>
        
        <!-- Relic Selection Screen -->
        <div id="screen-relic" class="screen">
            <div class="screen-header">
                <h2>âš¡ Choose a Relic</h2>
            </div>
            
            <div class="relic-selection-content">
                <div id="relic-options" class="relic-options">
                    <!-- Relic cards will be inserted here -->
                </div>
                
                <div class="relic-selection-actions">
                    <button id="btn-select-relic" class="btn btn-primary btn-large hidden">
                        Select <span id="selected-relic-name"></span>
                    </button>
                    <button id="btn-skip-relic" class="btn btn-secondary">
                        Skip (Continue without relic)
                    </button>
                    <button id="btn-relic-home" class="btn btn-abandon">
                        ğŸ  Home
                    </button>
                </div>
            </div>
            
            <!-- Current Relics Display (at bottom, like in battle) -->
            <div id="current-relics" class="current-relics">
                <!-- Current relic slots will be shown here -->
            </div>
        </div>
        
        <!-- Relic Tooltip -->
        <div id="relic-tooltip-overlay" class="relic-tooltip-overlay"></div>
        <div id="relic-tooltip" class="relic-tooltip">
            <button id="btn-close-tooltip" class="btn-close-tooltip">âœ–</button>
            <div class="relic-tooltip-header">
                <div id="tooltip-icon" class="relic-tooltip-icon"></div>
                <div id="tooltip-name" class="relic-tooltip-name"></div>
            </div>
            <div id="tooltip-description" class="relic-tooltip-description"></div>
        </div>
        
        <!-- Relic Confirmation Modal -->
        <div id="relic-confirmation-modal" class="modal hidden">
            <div class="modal-content">
                <h3 id="relic-confirm-title">âš¡ Confirm Relic Selection</h3>
                <div id="relic-confirm-content">
                    <div class="relic-confirm-header">
                        <div id="confirm-icon" class="relic-confirm-icon"></div>
                        <div>
                            <div id="confirm-name" class="relic-confirm-name"></div>
                            <div id="confirm-description" class="relic-confirm-description"></div>
                        </div>
                    </div>
                    <div id="relic-confirm-replace-info" class="relic-confirm-replace-info hidden"></div>
                </div>
                <div class="modal-actions">
                    <button id="btn-relic-confirm" class="btn btn-primary">Confirm</button>
                    <button id="btn-relic-cancel" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Home Confirmation Modal -->
        <div id="home-confirmation-modal" class="modal hidden">
            <div class="modal-content">
                <h3>âš ï¸ Return to Menu?</h3>
                <p>Your current progress will be lost and the run will end.</p>
                <div class="modal-actions">
                    <button id="btn-home-confirm" class="btn btn-primary">Yes, Return</button>
                    <button id="btn-home-cancel" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- How to Play Modal -->
        <div id="how-to-play-modal" class="modal hidden">
            <div class="modal-content modal-guide">
                <button id="btn-close-guide" class="btn-close-modal">âœ–</button>
                <h2>ğŸ“– How to Play</h2>
                <div class="guide-content">
                    <h4>âš”ï¸ Combat</h4>
                    <p>This is an auto-battler. Your hero fights automatically. Watch them clash!</p>
                    
                    <h4>ğŸ“Š Stats</h4>
                    <p><strong>Attack:</strong> Base damage per hit (+2 per point)<br>
                    <strong>Attack Speed:</strong> Attacks per second (+0.12 per point, max 6.0)<br>
                    <strong>Critical:</strong> Double damage chance (+2% per point, max 75%)<br>
                    <strong>Lifesteal:</strong> Heal for % of damage dealt (+2% per point, max 40%)<br>
                    <strong>Defense:</strong> Reduces incoming damage (+2 per point)<br>
                    <strong>HP:</strong> Health points (+10 per point)</p>
                    
                    <h4>ğŸ—¼ Floors & Progression</h4>
                    <p>Start with 5 stat points. Every 5 floors, gain 5 more points to improve your build.</p>
                    <p>Enemies get stronger each floor. Adaptive AI counters your strategy!</p>
                    
                    <h4>ğŸ’€ Permadeath</h4>
                    <p>One life per run. If you lose, your run ends. Top 3 runs are saved!</p>
                    
                    <h4>ğŸ¯ Goal</h4>
                    <p>Climb as high as you can. Build wisely, adapt, and reach the top!</p>
                    
                    <h4>ğŸ”„ Relics</h4>
                    <p>Start with 1 relic at the beginning, then gain 1 relic every 10 floors (10, 20, 30...). You can equip up to 3 relics at once. If you already have 3, you can replace one with a new one.</p>
                    
                    <h4>âš¡ Relics List</h4>
                    <div class="relics-guide">
                        <h5>Shield System:</h5>
                        <p><strong>ğŸ’ Diamond Shield:</strong> Gain a shield equal to 25% max HP at battle start. Shield prevents critical hits and absorbs damage first</p>
                        <p><strong>ğŸ”„ Shield Battery:</strong> Shield regenerates 10% of max HP every 5 seconds (if shield is broken)</p>
                        
                        <h5>Offensive Relics:</h5>
                        <p><strong>âš”ï¸ Berserker Rage:</strong> +15% Attack, -10% Max HP</p>
                        <p><strong>ğŸ’¥ Critical Mass:</strong> Crits deal 2.5x damage instead of 2x</p>
                        <p><strong>ğŸ¯ First Blood:</strong> First hit always crits</p>
                        <p><strong>ğŸ”ª Armor Piercing:</strong> Ignore 30% of enemy defense</p>
                        <p><strong>âš¡ Double Strike:</strong> 15% chance to attack twice</p>
                        <p><strong>â˜ ï¸ Execute:</strong> Deal 3x damage to enemies below 20% HP</p>
                        <p><strong>ğŸ©¸ Bleed:</strong> Attacks apply 5% max HP bleed over 3s</p>
                        <p><strong>âš”ï¸ Rage Combo:</strong> Each consecutive hit increases damage by 5% (max 50%, resets on miss)</p>
                        <p><strong>ğŸ¯ Weak Point:</strong> Each attack ignores 2% more of enemy defense (max 60%)</p>
                        <p><strong>ğŸ”¥ Spite:</strong> Below 30% HP, deal +60% damage</p>
                        <p><strong>âš”ï¸ Executioner:</strong> Deal +50% damage to enemies below 40% HP</p>
                        <p><strong>ğŸ¯ Precision Strike:</strong> Attacks cannot miss, but deal -10% damage</p>
                        
                        <h5>Defensive Relics:</h5>
                        <p><strong>ğŸŒ¬ï¸ Second Wind:</strong> Heal 25% HP when dropping below 30% (once per battle)</p>
                        <p><strong>ğŸŒµ Thorns:</strong> Reflect 20% of damage taken</p>
                        <p><strong>ğŸ›¡ï¸ Fortify:</strong> +50 flat HP</p>
                        <p><strong>ğŸ° Shield Wall:</strong> +15 Defense, -15% Attack Speed</p>
                        <p><strong>ğŸ’š Regeneration:</strong> Heal 2% max HP per second</p>
                        <p><strong>âš”ï¸ Last Stand:</strong> Survive lethal damage once at 1 HP, gain +50% damage for 5s</p>
                        <p><strong>ğŸ˜ Thick Skin:</strong> Take 15% less damage from all sources</p>
                        <p><strong>ğŸ›¡ï¸ Battle Hardened:</strong> Each hit taken increases defense by 1 (max +20, resets on heal above 80% HP)</p>
                        <p><strong>ğŸ’« Blink:</strong> 20% chance to dodge any attack completely</p>
                        <p><strong>ğŸ›¡ï¸ Iron Will:</strong> Take 10% less damage from critical hits, +20 Defense</p>
                        <p><strong>âš”ï¸ Retaliate:</strong> First 5 hits received, counter-attack immediately for 40% of normal damage</p>
                        
                        <h5>Utility/Hybrid Relics:</h5>
                        <p><strong>ğŸ§› Vampire:</strong> +15% Lifesteal (flat)</p>
                        <p><strong>ğŸ’¨ Haste:</strong> +0.5 Attack Speed</p>
                        <p><strong>ğŸ“ˆ Momentum:</strong> Deal 1% more damage per second of combat (max 30%)</p>
                        <p><strong>ğŸ©¸ Blood Pact:</strong> Lose 10% max HP, gain +20% damage and +10% lifesteal</p>
                        <p><strong>ğŸ’ª Adrenaline:</strong> Below 50% HP, gain +25% attack speed</p>
                        <p><strong>âš–ï¸ Balanced Stance:</strong> +5% to all stats</p>
                        <p><strong>âš¡ Power Spike:</strong> Every 5 floors, gain +10% to all stats (permanent)</p>
                        <p><strong>âš—ï¸ Potion Master:</strong> Heal 3% max HP every 3 seconds, but lose 1% max HP permanently each floor</p>
                        <p><strong>ğŸ”„ Recycle:</strong> When you dodge or miss, gain +15% attack speed for 3 seconds</p>
                        <p><strong>âš¡ Energy Surge:</strong> Every 4 seconds, next attack deals 2.5x damage and cannot miss. -15% attack speed</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Battle Screen -->
        <div id="screen-battle" class="screen">
            <div class="battle-header">
                <div class="floor-display">Floor <span id="current-floor">1</span></div>
                <div class="archetype-display">
                    <span id="archetype-name">Balanced</span>
                </div>
                <div class="battle-controls">
                    <button id="btn-speed-toggle" class="btn btn-speed">1x</button>
                    <button id="btn-abandon" class="btn btn-abandon">âŒ</button>
                </div>
            </div>
            
            <!-- Abandon Confirmation Modal -->
            <div id="abandon-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>âš ï¸ Abandon Run?</h3>
                    <p>Your progress will be lost and the run will end.</p>
                    <div class="modal-actions">
                        <button id="btn-abandon-confirm" class="btn btn-primary">Yes, Abandon</button>
                        <button id="btn-abandon-cancel" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
            
            <div class="battle-arena">
                <!-- Canvas 1: Battle rendering (sprites, background, floating text) -->
                <canvas id="battle-canvas" class="battle-canvas-main"></canvas>
                
                <!-- Canvas 2: UI rendering (HP bars and stats) -->
                <canvas id="battle-ui-canvas" class="battle-canvas-ui"></canvas>
            </div>
            
            <div class="battle-status">
                <div id="battle-message">Auto-battle in progress...</div>
            </div>
            
            <!-- Relic Display in Battle -->
            <div id="battle-relics" class="battle-relics">
                <div class="battle-relic-slot empty"></div>
                <div class="battle-relic-slot empty"></div>
                <div class="battle-relic-slot empty"></div>
            </div>
        </div>
        
        <!-- Result Screen -->
        <div id="screen-result" class="screen">
            <div class="result-header">
                <h2>ğŸ’€ RUN ENDED</h2>
            </div>
            
            <div class="result-content">
                <div class="result-card">
                    <div class="result-label">Floor Reached</div>
                    <div class="result-value floor-value" id="result-floor">1</div>
                </div>
                
                <div class="result-card">
                    <div class="result-label">Duration</div>
                    <div class="result-value" id="result-duration">0s</div>
                </div>
                
                <div class="result-card">
                    <div class="result-label">Difficulty</div>
                    <div class="result-value" id="result-difficulty">Normal</div>
                </div>
                
                <div id="top-run-badge" class="top-run-badge hidden">
                    ğŸ† TOP 3! ğŸ†
                </div>
                
                <div class="final-build">
                    <h3>Final Build</h3>
                    <div class="build-stats" id="final-build-stats"></div>
                    
                    <!-- Relics Display -->
                    <div class="final-relics">
                        <h4 style="font-size: clamp(10px, 3vw, 14px); color: #d4af37; margin-bottom: 8px;">âš¡ Relics</h4>
                        <div id="final-relics-slots" class="final-relics-slots">
                            <div class="final-relic-slot empty"></div>
                            <div class="final-relic-slot empty"></div>
                            <div class="final-relic-slot empty"></div>
                        </div>
                    </div>
                </div>
                
                <div class="result-card result-actions-card">
                    <div class="result-actions">
                        <button id="btn-restart" class="btn btn-primary btn-large">
                            ğŸ”„ RESTART
                        </button>
                        <button id="btn-back-menu" class="btn btn-secondary btn-large">
                            BACK TO MENU
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Install prompt -->
    <div id="install-prompt" class="install-prompt hidden">
        <div class="install-content">
            <p>ğŸ“± Install Infinite Tower on your device?</p>
            <button id="btn-install" class="btn btn-primary">Install</button>
            <button id="btn-dismiss" class="btn btn-secondary">Later</button>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/combat.js"></script>
    <script src="js/enemy.js"></script>
    <script src="js/relics.js"></script>
    <script src="js/game.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

