<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="Infinite Tower - Roguelike Auto-Battler">
    
    <title>Infinite Tower</title>
    
    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Game Container -->
    <div id="game-container">
        
        <!-- Main Menu Screen -->
        <div id="screen-menu" class="screen active">
            <div class="title-container">
                <h1 class="game-title">INFINITE TOWER</h1>
                <div class="subtitle">Roguelike Auto-Battler</div>
                <div class="version">v2.4.0</div>
            </div>
            
            <div class="menu-content">
                <button id="btn-play" class="btn btn-primary btn-large">
                    ‚öîÔ∏è PLAY
                </button>
                
                <div class="difficulty-section">
                    <h3>Difficulty</h3>
                    <div class="difficulty-buttons">
                        <button class="btn btn-difficulty" data-difficulty="easy">
                            Easy
                        </button>
                        <button class="btn btn-difficulty active" data-difficulty="normal">
                            Normal
                        </button>
                        <button class="btn btn-difficulty" data-difficulty="hard">
                            Hard
                        </button>
                    </div>
                </div>
                
                <button id="btn-how-to-play" class="btn btn-secondary">
                    üìñ How to Play
                </button>
                
                <button id="btn-top-runs" class="btn btn-secondary">
                    üèÜ Top 3 Runs
                </button>
                
                <!-- Top Runs Panel -->
                <div id="top-runs-panel" class="panel hidden">
                    <h3>Best 3 Runs</h3>
                    <div id="top-runs-list"></div>
                </div>
            </div>
        </div>
        
        <!-- Stat Allocation Screen -->
        <div id="screen-stats" class="screen">
            <div class="screen-header">
                <h2 id="stats-title">Initial Build</h2>
                <div class="points-display">
                    Points: <span id="points-available">5</span>
                </div>
            </div>
            
            <div class="stats-content">
                <div class="stat-row" data-stat="attackSpeed">
                    <div class="stat-info">
                        <div class="stat-name">‚ö° Attack Speed</div>
                        <div class="stat-description">Attacks per second. More attacks = more damage over time. Max: 7.0</div>
                        <div class="stat-value">
                            <span id="stat-attackSpeed">1.0</span>/s
                            <span class="stat-max"></span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="attackSpeed">‚àí</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="attackSpeed">+</button>
                    </div>
                </div>
                
                <div class="stat-row" data-stat="attack">
                    <div class="stat-info">
                        <div class="stat-name">‚öîÔ∏è Attack</div>
                        <div class="stat-description">Base damage per hit. Higher attack means stronger hits.</div>
                        <div class="stat-value">
                            <span id="stat-attack">10</span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="attack">‚àí</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="attack">+</button>
                    </div>
                </div>
                
                <div class="stat-row" data-stat="crit">
                    <div class="stat-info">
                        <div class="stat-name">üí• Critical</div>
                        <div class="stat-description">Chance to deal double damage (+2% per point). Max: 75%</div>
                        <div class="stat-value">
                            <span id="stat-crit">5</span>%
                            <span class="stat-max"></span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="crit">‚àí</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="crit">+</button>
                    </div>
                </div>
                
                <div class="stat-row" data-stat="lifesteal">
                    <div class="stat-info">
                        <div class="stat-name">ü©∏ Lifesteal</div>
                        <div class="stat-description">Heal for % of damage dealt. Synergizes with Attack Speed. Max: 40%</div>
                        <div class="stat-value">
                            <span id="stat-lifesteal">0</span>%
                            <span class="stat-max"></span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="lifesteal">‚àí</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="lifesteal">+</button>
                    </div>
                </div>
                
                <div class="stat-row" data-stat="defense">
                    <div class="stat-info">
                        <div class="stat-name">üõ°Ô∏è Defense</div>
                        <div class="stat-description">Reduces damage from each hit. Essential for survival.</div>
                        <div class="stat-value">
                            <span id="stat-defense">5</span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="defense">‚àí</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="defense">+</button>
                    </div>
                </div>
                
                <div class="stat-row" data-stat="hp">
                    <div class="stat-info">
                        <div class="stat-name">‚ù§Ô∏è Max HP</div>
                        <div class="stat-description">Health points. When it reaches 0, you lose. Stay alive!</div>
                        <div class="stat-value">
                            <span id="stat-hp">100</span>
                        </div>
                    </div>
                    <div class="stat-buttons">
                        <button class="btn btn-stat btn-stat-minus" data-stat="hp">‚àí</button>
                        <button class="btn btn-stat btn-stat-plus" data-stat="hp">+</button>
                    </div>
                </div>
            </div>
            
            <button id="btn-start-battle" class="btn btn-primary btn-large" disabled>
                Allocate all points first
            </button>
            
            <button id="btn-stats-back-menu" class="btn btn-secondary">
                ‚¨ÖÔ∏è Back to Menu
            </button>
        </div>
        
        <!-- Relic Selection Screen -->
        <div id="screen-relic" class="screen">
            <div class="screen-header">
                <h2>‚ö° Choose a Relic</h2>
            </div>
            
            <div class="relic-selection-content">
                <div id="relic-options" class="relic-options">
                    <!-- Relic cards will be inserted here -->
                </div>
                
                <button id="btn-skip-relic" class="btn btn-secondary">
                    Skip
                </button>
            </div>
            
            <!-- Current Relics Display (at bottom, like in battle) -->
            <div id="current-relics" class="current-relics">
                <!-- Current relic slots will be shown here -->
            </div>
        </div>
        
        <!-- Relic Tooltip -->
        <div id="relic-tooltip-overlay" class="relic-tooltip-overlay"></div>
        <div id="relic-tooltip" class="relic-tooltip">
            <div class="relic-tooltip-header">
                <div id="tooltip-icon" class="relic-tooltip-icon"></div>
                <div id="tooltip-name" class="relic-tooltip-name"></div>
            </div>
            <div id="tooltip-description" class="relic-tooltip-description"></div>
        </div>
        
        <!-- How to Play Modal -->
        <div id="how-to-play-modal" class="modal hidden">
            <div class="modal-content modal-guide">
                <button id="btn-close-guide" class="btn-close-modal">‚úñ</button>
                <h2>üìñ How to Play</h2>
                <div class="guide-content">
                    <h4>‚öîÔ∏è Combat</h4>
                    <p>This is an auto-battler. Your hero fights automatically. Watch them clash!</p>
                    
                    <h4>üìä Stats</h4>
                    <p><strong>Attack:</strong> Base damage per hit (+2 per point)<br>
                    <strong>Attack Speed:</strong> Attacks per second (+0.12 per point, max 6.0)<br>
                    <strong>Critical:</strong> Double damage chance (+2% per point, max 75%)<br>
                    <strong>Lifesteal:</strong> Heal for % of damage dealt (+2% per point, max 40%)<br>
                    <strong>Defense:</strong> Reduces incoming damage (+2 per point)<br>
                    <strong>HP:</strong> Health points (+10 per point)</p>
                    
                    <h4>üóº Floors & Progression</h4>
                    <p>Start with 5 stat points. Every 5 floors, gain 5 more points to improve your build.</p>
                    <p>Enemies get stronger each floor. Adaptive AI counters your strategy!</p>
                    
                    <h4>üíÄ Permadeath</h4>
                    <p>One life per run. If you lose, your run ends. Top 3 runs are saved!</p>
                    
                    <h4>üéØ Goal</h4>
                    <p>Climb as high as you can. Build wisely, adapt, and reach the top!</p>
                    
                    <h4>üîÑ Relics</h4>
                    <p>Every 5 floors, choose a relic to enhance your build. You can equip up to 3 relics at once. If you already have 3, you can replace one with a new one.</p>
                    
                    <h4>‚ö° Relics List</h4>
                    <div class="relics-guide">
                        <h5>Offensive Relics:</h5>
                        <p><strong>‚öîÔ∏è Berserker Rage:</strong> +15% Attack, -10% Max HP</p>
                        <p><strong>üí• Critical Mass:</strong> Crits deal 2.5x damage instead of 2x</p>
                        <p><strong>üéØ First Blood:</strong> First hit always crits</p>
                        <p><strong>üî™ Armor Piercing:</strong> Ignore 30% of enemy defense</p>
                        <p><strong>‚ö° Double Strike:</strong> 15% chance to attack twice</p>
                        <p><strong>‚ò†Ô∏è Execute:</strong> Deal 3x damage to enemies below 20% HP</p>
                        <p><strong>ü©∏ Bleed:</strong> Attacks apply 5% max HP bleed over 3s</p>
                        
                        <h5>Defensive Relics:</h5>
                        <p><strong>üå¨Ô∏è Second Wind:</strong> Heal 25% HP when dropping below 30% (once per battle)</p>
                        <p><strong>üåµ Thorns:</strong> Reflect 20% of damage taken</p>
                        <p><strong>üõ°Ô∏è Fortify:</strong> +50 flat HP</p>
                        <p><strong>üè∞ Shield Wall:</strong> +15 Defense, -15% Attack Speed</p>
                        <p><strong>üíö Regeneration:</strong> Heal 2% max HP per second</p>
                        <p><strong>‚öîÔ∏è Last Stand:</strong> Survive lethal damage once at 1 HP, gain +50% damage for 5s</p>
                        <p><strong>üêò Thick Skin:</strong> Take 15% less damage from all sources</p>
                        
                        <h5>Utility/Hybrid Relics:</h5>
                        <p><strong>üßõ Vampire:</strong> +15% Lifesteal (flat)</p>
                        <p><strong>üí® Haste:</strong> +0.5 Attack Speed</p>
                        <p><strong>üìà Momentum:</strong> Deal 1% more damage per second of combat (max 30%)</p>
                        <p><strong>ü©∏ Blood Pact:</strong> Lose 10% max HP, gain +20% damage and +10% lifesteal</p>
                        <p><strong>üí™ Adrenaline:</strong> Below 50% HP, gain +25% attack speed</p>
                        <p><strong>‚öñÔ∏è Balanced Stance:</strong> +5% to all stats</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Battle Screen -->
        <div id="screen-battle" class="screen">
            <div class="battle-header">
                <div class="floor-display">Floor <span id="current-floor">1</span></div>
                <div class="archetype-display">
                    <span id="archetype-name">Balanced</span>
                </div>
                <div class="battle-controls">
                    <button id="btn-speed-toggle" class="btn btn-speed">1x</button>
                    <button id="btn-abandon" class="btn btn-abandon">‚ùå</button>
                </div>
            </div>
            
            <!-- Abandon Confirmation Modal -->
            <div id="abandon-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>‚ö†Ô∏è Abandon Run?</h3>
                    <p>Your progress will be lost and the run will end.</p>
                    <div class="modal-actions">
                        <button id="btn-abandon-confirm" class="btn btn-primary">Yes, Abandon</button>
                        <button id="btn-abandon-cancel" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
            
            <div class="battle-arena">
                <!-- Canvas 1: Battle rendering (sprites, background, floating text) -->
                <canvas id="battle-canvas" class="battle-canvas-main"></canvas>
                
                <!-- Canvas 2: UI rendering (HP bars and stats) -->
                <canvas id="battle-ui-canvas" class="battle-canvas-ui"></canvas>
            </div>
            
            <div class="battle-status">
                <div id="battle-message">Auto-battle in progress...</div>
            </div>
            
            <!-- Relic Display in Battle -->
            <div id="battle-relics" class="battle-relics">
                <div class="battle-relic-slot empty"></div>
                <div class="battle-relic-slot empty"></div>
                <div class="battle-relic-slot empty"></div>
            </div>
        </div>
        
        <!-- Result Screen -->
        <div id="screen-result" class="screen">
            <div class="result-header">
                <h2>üíÄ RUN ENDED</h2>
            </div>
            
            <div class="result-content">
                <div class="result-card">
                    <div class="result-label">Floor Reached</div>
                    <div class="result-value floor-value" id="result-floor">1</div>
                </div>
                
                <div class="result-card">
                    <div class="result-label">Duration</div>
                    <div class="result-value" id="result-duration">0s</div>
                </div>
                
                <div class="result-card">
                    <div class="result-label">Difficulty</div>
                    <div class="result-value" id="result-difficulty">Normal</div>
                </div>
                
                <div id="top-run-badge" class="top-run-badge hidden">
                    üèÜ TOP 3! üèÜ
                </div>
                
                <div class="final-build">
                    <h3>Final Build</h3>
                    <div class="build-stats" id="final-build-stats"></div>
                    
                    <!-- Relics Display -->
                    <div class="final-relics">
                        <h4 style="font-size: clamp(10px, 3vw, 14px); color: #d4af37; margin-bottom: 8px;">‚ö° Relics</h4>
                        <div id="final-relics-slots" class="final-relics-slots">
                            <div class="final-relic-slot empty"></div>
                            <div class="final-relic-slot empty"></div>
                            <div class="final-relic-slot empty"></div>
                        </div>
                    </div>
                </div>
                
                <div class="result-card result-actions-card">
                    <div class="result-actions">
                        <button id="btn-restart" class="btn btn-primary btn-large">
                            üîÑ RESTART
                        </button>
                        <button id="btn-back-menu" class="btn btn-secondary btn-large">
                            BACK TO MENU
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Install prompt -->
    <div id="install-prompt" class="install-prompt hidden">
        <div class="install-content">
            <p>üì± Install Infinite Tower on your device?</p>
            <button id="btn-install" class="btn btn-primary">Install</button>
            <button id="btn-dismiss" class="btn btn-secondary">Later</button>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/combat.js"></script>
    <script src="js/enemy.js"></script>
    <script src="js/relics.js"></script>
    <script src="js/game.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

