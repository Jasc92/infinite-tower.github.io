# Development Log - November 1, 2025

## Project Initialization

### Initial Approach: Android Native App
- Started development as Android native app using Kotlin + Jetpack Compose
- Created complete Android project structure:
  - Gradle build configuration
  - AndroidManifest.xml
  - Full game logic in Kotlin
  - Compose UI screens (Main Menu, Stat Allocation, Battle, Result)
  - Combat engine and enemy generation systems
  - Game state management
  - Android resource files (themes, colors, strings)
  - Build guides and documentation

### Pivot Decision: Switch to PWA
**Reason**: User wanted simpler testing and deployment without Android Studio/USB setup

**Actions Taken**:
- Deleted all Android-related files
- Rebuilt project as Progressive Web App (PWA)
- Maintained exact same game logic and mechanics
- Adapted UI for web/mobile browsers

---

## PWA Implementation

### Project Structure Created
```
pwa/
‚îú‚îÄ‚îÄ index.html          # Main HTML structure
‚îú‚îÄ‚îÄ manifest.json       # PWA manifest
‚îú‚îÄ‚îÄ service-worker.js   # Offline support
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ styles.css     # Complete styling
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îú‚îÄ‚îÄ app.js         # UI control & rendering
‚îÇ   ‚îú‚îÄ‚îÄ game.js        # Game state manager
‚îÇ   ‚îú‚îÄ‚îÄ combat.js      # Combat engine
‚îÇ   ‚îî‚îÄ‚îÄ enemy.js       # Enemy generation & AI
‚îî‚îÄ‚îÄ assets/
    ‚îú‚îÄ‚îÄ hero.png       # User-provided pixel art
    ‚îú‚îÄ‚îÄ enemy.png      # User-provided pixel art
    ‚îî‚îÄ‚îÄ background.png # Battle background
```

### Core Features Implemented

#### 1. Game State Management (`game.js`)
- Player stats initialization and management
- Enemy generation coordination
- Floor progression logic
- Difficulty multipliers (Easy: 0.8, Normal: 1.0, Hard: 1.3)
- Adaptive AI archetype system
- Battle speed toggle (initially 1x/2x)
- Top Runs tracking with LocalStorage

#### 2. Combat Engine (`combat.js`)
- Continuous-time combat system
- Attack timer management based on Attack Speed stat
- Damage calculation sequence:
  1. Evasion check (random roll)
  2. Critical hit check (random roll, 2x damage)
  3. Defense subtraction
  4. Minimum 1 damage guarantee
- Win/loss detection

#### 3. Enemy Generation & Adaptive AI (`enemy.js`)
- Enemy stat scaling formula: `base * (1 + floor * 0.15) * difficulty * bias`
- Three archetypes with specific biases:
  - **BALANCED**: Default baseline stats
  - **TANK**: High defense/HP, counters Attack Speed builds
  - **GLASS CANNON**: High attack/crit, counters defensive builds
- Archetype selection logic:
  - First 3 floors: BALANCED
  - Every 3 floors after: analyze player's highest stat investment
  - Counter selection based on player build

#### 4. UI & Rendering (`app.js`)
- Screen navigation system (Main Menu, Stats, Battle, Result)
- Canvas-based battle rendering
- Stat allocation interface with increment/decrement buttons
- Real-time stat display updates
- Battle animation loop using `requestAnimationFrame`
- Top Runs display and management

#### 5. Visual Design (`styles.css`)
- Dark theme color scheme:
  - Primary: #16213e
  - Secondary: #0f3460
  - Accent: #e94560
  - Warning: #f1a208
- Button styles and hover effects
- Stat panel layouts
- Mobile-first responsive design (initial implementation)

---

## Asset Integration

### User-Provided Graphics
- **Hero sprite**: Pixel art character (500x500px)
- **Enemy sprite**: Pixel art creature (500x500px)
- **Background**: Fantasy dungeon scene

### Initial Scaling Issues
**Problem**: Sprites appeared too large on screen

**Solutions Attempted**:
1. Applied 2x fixed scaling (still too large)
2. Changed to adaptive scaling: `Math.min(canvas.width / 800, 1.0)`
3. User manually resized images and re-uploaded
4. Removed all scaling factors to use native image size

**Browser Caching Issue**:
- Old large images remained cached
- Solution: Hard refresh instructions provided (Ctrl+Shift+R / Cmd+Shift+R)

### Background Rendering Issue
**Problem**: Background image was stretched/flattened

**Solution**: Implemented aspect-ratio-preserving rendering
- Calculate canvas vs background ratios
- Scale to cover canvas while maintaining proportions
- Center the image (like CSS `background-size: cover`)

```javascript
const canvasRatio = canvas.width / canvas.height;
const bgRatio = bgWidth / bgHeight;

if (canvasRatio > bgRatio) {
    drawWidth = canvas.width;
    drawHeight = canvas.width / bgRatio;
    offsetX = 0;
    offsetY = (canvas.height - drawHeight) / 2;
} else {
    drawWidth = canvas.height * bgRatio;
    drawHeight = canvas.height;
    offsetX = (canvas.width - drawWidth) / 2;
    offsetY = 0;
}
```

---

## UI/UX Improvements

### Character Positioning
- Hero positioned at 25% canvas width (left side)
- Enemy positioned at 75% canvas width (right side)
- Both centered vertically at 55% canvas height
- Sprites drawn centered on their positions

### Stat Panel Positioning
**Problem**: HP/stats boxes were in wrong positions

**Solution**: Moved to top corners
- Player panel: top-left (10px from edges)
- Enemy panel: top-right (10px from edges)
- Used `position: absolute` with fixed positioning

### Responsive Design (Initial)
- Basic mobile viewport meta tag
- Initial responsive font sizes
- Touch-friendly button sizing

---

## GitHub Deployment Setup

### Repository Configuration
- Created GitHub repository: `Jasc92/infinite-tower.github.io`
- Cloned repository to local machine
- Initial file structure confusion (PWA files in subdirectory)

### Deployment Issues Resolved

**Problem 1**: GitHub Pages 404 error
- **Cause**: Files were in `pwa/` subfolder instead of root
- **Solution**: Moved all files to repository root

**Problem 2**: Git remote connection
- **Cause**: Multiple initialization attempts, confusion about working directory
- **Solution**: 
  - Properly initialized Git in correct directory
  - Added remote: `git remote add origin https://github.com/Jasc92/infinite-tower.github.io.git`
  - Used Personal Access Token for authentication
  - Successfully pushed to main branch

**Problem 3**: Old `pwa/` folder persisting
- **Cause**: Folder remained after moving files out
- **Solution**: Deleted empty `pwa/` folder, re-committed

### Final Structure
```
infinite-tower.github.io/ (repository root)
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ manifest.json
‚îú‚îÄ‚îÄ service-worker.js
‚îú‚îÄ‚îÄ css/
‚îú‚îÄ‚îÄ js/
‚îú‚îÄ‚îÄ assets/
‚îî‚îÄ‚îÄ documentation files
```

---

## Language Localization

### Translation to English
**Initial State**: Mixed Spanish/English (some code comments in Spanish)

**Changes Made**:
- Translated all UI text in `index.html`:
  - Button labels
  - Screen titles
  - Instructions
  - Stat labels
- Updated JavaScript strings in `app.js`:
  - Difficulty names
  - Result messages
  - Button text
  - Tooltips
- Updated `enemy.js` archetype names:
  - "Equilibrado" ‚Üí "Balanced"
  - "Tanque" ‚Üí "Tank"  
  - "Ca√±√≥n de cristal" ‚Üí "Glass Cannon"
- Set PWA manifest language: `"lang": "en-US"`

---

## Testing & Debugging

### Local Testing Setup
- Used Python HTTP server: `python -m http.server 8000`
- Tested on desktop browser
- Verified PWA manifest and service worker

### Issues Encountered & Fixed
1. ‚úÖ Sprite scaling (too large ‚Üí corrected)
2. ‚úÖ Background aspect ratio (stretched ‚Üí fixed)
3. ‚úÖ Stat panel positioning (incorrect ‚Üí moved to corners)
4. ‚úÖ Character centering (off-center ‚Üí properly centered)
5. ‚úÖ GitHub Pages deployment (404 ‚Üí working)
6. ‚úÖ Git repository connection (disconnected ‚Üí connected)
7. ‚úÖ Language consistency (mixed ‚Üí full English)

---

## Documentation Created

### User-Facing Documentation
- `README.md`: Project overview and quick start
- `QUICK_START.md`: How to run locally
- `HOW_TO_TEST_LOCALLY.md`: Local testing instructions
- Various Git setup guides (later consolidated)

### Developer Documentation
- Inline code comments
- Git commit messages documenting changes
- Build and deployment instructions

---

## Commits Made (Key Milestones)

1. Initial PWA structure and game logic
2. Asset integration and sprite rendering
3. Combat speed and UI refinements
4. Translation to English
5. Background aspect ratio fix
6. Final deployment configuration

---

## End of Day Status

### ‚úÖ Completed
- Full PWA implementation with all game mechanics
- Adaptive AI system working
- Combat engine functional
- Asset integration complete
- GitHub Pages deployment working
- Full English localization
- Local testing capability

### üîÑ Known Issues
- Mobile responsiveness needs improvement (scrolling required)
- Battle speed only toggles between 1x and 2x
- Enemy strategy displayed to player (gives away AI adaptation)

### üìù Next Steps
- Improve mobile viewport handling
- Enhance responsive design for no-scroll gameplay
- Further UI polish

